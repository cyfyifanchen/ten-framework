version: "3"

vars:
  OS: "linux"
  ARCH: "x64"
  BUILD_TYPE: "debug"

tasks:
  gen-tman:
    desc: generate tman for local development
    vars:
      GEN_EXTRA_ARGS: "log_level=1 ten_enable_ten_rust=true ten_enable_ten_manager=true ten_enable_tests_cleanup=false ten_enable_nodejs_binding=false ten_enable_python_binding=false ten_enable_go_binding=false"
    cmds:
      - tgn gen {{ .OS }} {{ .ARCH }} {{ .BUILD_TYPE }} -- {{ .GEN_EXTRA_ARGS }} {{ .CLI_ARGS }}

  build-tman:
    desc: build tman only
    cmds:
      - tgn build:"ten_manager_package tests/ten_manager" {{ .OS }} {{ .ARCH }} {{ .BUILD_TYPE }} {{ .CLI_ARGS }}

  gen:
    desc: gen
    cmds:
      - tgn gen {{ .OS }} {{ .ARCH }} {{ .BUILD_TYPE }} {{ .CLI_ARGS }}

  build:
    desc: build
    cmds:
      - tgn build {{ .OS }} {{ .ARCH }} {{ .BUILD_TYPE }} {{ .CLI_ARGS }}

  clean:
    desc: clean build
    cmds:
      - rm -rf out

  biome-install:
    desc: install root node deps (biome)
    internal: true
    sources:
      - package.json
      - package-lock.json
    generates:
      - node_modules/.bin/biome
    cmds:
      - npm ci

  biome-frontend-lint:
    desc: run biome lint for frontends
    deps: [biome-install]
    vars:
      FRONTEND_PATHS: "ai_agents/agents/examples ai_agents/playground core/src/ten_manager/designer_frontend"
    cmds:
      - ./node_modules/.bin/biome lint --config-path biome.json {{.FRONTEND_PATHS}}

  biome-frontend-check:
    desc: run biome check for frontends
    deps: [biome-install]
    vars:
      FRONTEND_PATHS: "ai_agents/agents/examples ai_agents/playground core/src/ten_manager/designer_frontend"
    cmds:
      - ./node_modules/.bin/biome check --config-path biome.json {{.FRONTEND_PATHS}}

  biome-frontend:
    desc: run biome lint and check for frontends
    cmds:
      - task: biome-frontend-lint
      - task: biome-frontend-check
